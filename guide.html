<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用指南 | Erra文档</title>
    <meta name="description" content="Erra文档">
    
    
    <link rel="preload" href="/erra/assets/css/0.styles.15b2353f.css" as="style"><link rel="preload" href="/erra/assets/js/app.714abe1d.js" as="script"><link rel="preload" href="/erra/assets/js/2.9ae94962.js" as="script"><link rel="preload" href="/erra/assets/js/3.e1545a35.js" as="script"><link rel="prefetch" href="/erra/assets/js/10.3a1efcc5.js"><link rel="prefetch" href="/erra/assets/js/11.8a56c68c.js"><link rel="prefetch" href="/erra/assets/js/4.06a0ec70.js"><link rel="prefetch" href="/erra/assets/js/5.d7a04dca.js"><link rel="prefetch" href="/erra/assets/js/6.1d4be018.js"><link rel="prefetch" href="/erra/assets/js/7.67df7b80.js"><link rel="prefetch" href="/erra/assets/js/8.9d233881.js"><link rel="prefetch" href="/erra/assets/js/9.db9228b3.js">
    <link rel="stylesheet" href="/erra/assets/css/0.styles.15b2353f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/erra/" class="home-link router-link-active"><!----> <span class="site-name">Erra文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/hughfenghen/erra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://hughfenghen.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  风痕的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/hughfenghen/erra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://hughfenghen.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  风痕的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/erra/" class="sidebar-link">Erra</a></li><li><a href="/erra/start.html" class="sidebar-link">快速启动</a></li><li><a href="/erra/trust-ca.html" class="sidebar-link">信任证书</a></li><li><a href="/erra/guide.html" class="active sidebar-link">使用指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/erra/guide.html#概览" class="sidebar-link">概览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/erra/guide.html#ui界面" class="sidebar-link">UI界面</a></li></ul></li><li class="sidebar-sub-header"><a href="/erra/guide.html#请求列表" class="sidebar-link">请求列表</a></li><li class="sidebar-sub-header"><a href="/erra/guide.html#断点编辑" class="sidebar-link">断点编辑</a></li><li class="sidebar-sub-header"><a href="/erra/guide.html#使用snippet" class="sidebar-link">使用Snippet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/erra/guide.html#接口绑定snippet" class="sidebar-link">接口绑定Snippet</a></li></ul></li><li class="sidebar-sub-header"><a href="/erra/guide.html#编写snippet" class="sidebar-link">编写Snippet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/erra/guide.html#修改返回值" class="sidebar-link">修改返回值</a></li><li class="sidebar-sub-header"><a href="/erra/guide.html#集成mockjs，生成随机数" class="sidebar-link">集成mockjs，生成随机数</a></li><li class="sidebar-sub-header"><a href="/erra/guide.html#代理转发请求" class="sidebar-link">代理转发请求</a></li><li class="sidebar-sub-header"><a href="/erra/guide.html#注入eruda" class="sidebar-link">注入Eruda</a></li><li class="sidebar-sub-header"><a href="/erra/guide.html#注入erra界面" class="sidebar-link">注入Erra界面</a></li><li class="sidebar-sub-header"><a href="/erra/guide.html#snippet引用" class="sidebar-link">Snippet引用</a></li></ul></li></ul></li><li><a href="/erra/config-desc.html" class="sidebar-link">配置说明</a></li><li><a href="/erra/design.html" class="sidebar-link">设计文档</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用指南"><a href="#使用指南" class="header-anchor">#</a> 使用指南</h1> <h2 id="概览"><a href="#概览" class="header-anchor">#</a> 概览</h2> <blockquote><p>Erra由一个http(s)代理服务加UI界面组成，用户通过界面控制代理服务器的行为来实现各种功能。<br>
详情请参阅<a href="/erra/design.html">设计文档</a></p></blockquote> <h3 id="ui界面"><a href="#ui界面" class="header-anchor">#</a> UI界面</h3> <p><img src="/erra/assets/img/overview.db493601.png" alt="UI概览">
Erra界面由三个Tab页组成：</p> <ol><li>Network：记录所有经过代理服务器的Http请求。</li> <li>Snippet：编写、管理Snippet。</li> <li>BP Queue：命中断点的请求会产生一个断点消息天到队列中，由用户进行处理。</li></ol> <h2 id="请求列表"><a href="#请求列表" class="header-anchor">#</a> 请求列表</h2> <p>如图，在列表页你可以</p> <ol><li>控制是否需要记录代理服务器的请求</li> <li>清理列表内容</li> <li>设置断点</li> <li>查看请求的Request、Response（只读）</li> <li>给请求快速绑定Snippet，后续请求数据会被Snippet修改<br> <img src="/erra/assets/img/record-list.af3de962.jpg" alt="请求列表页"></li></ol> <h2 id="断点编辑"><a href="#断点编辑" class="header-anchor">#</a> 断点编辑</h2> <p>给请求添加断点后，后续相同请求触发时会在BP Queue页面产生一条记录。<br>
此时你可以编辑请求的内容，点击“完成”按钮后，请求才会进行下一步（发送到远程服务器或者被浏览器接收）。<br>
此外你还可以选择跳过、中断当前请求；开关断点功能、跳过所有断点消息；勾选“自动开始下一个”表示处理完当前消息会马上激活下一条消息。<br> <img src="/erra/assets/img/bp-edit.e0803ecc.png" alt="断点编辑"></p> <h2 id="使用snippet"><a href="#使用snippet" class="header-anchor">#</a> 使用Snippet</h2> <p>到这里，我们已经拥有了随意编辑Http请求的能力，但是断点编辑的效率很低。<br>
开发调式阶段，同一个请求很可能会被发起多次，如果每次请求都需要断点编辑，这是无法忍受的。接口绑定Snippet后，后续该接口的数据会自动被Snippet修改。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果不理解Snippet的含义可以参阅<a href="/erra/design.html#Snippet解释">Snippet解释</a>，Snippet字段含义参阅<a href="/erra/config-desc.html#snippet">配置说明</a>。<br> <em>若你还没有安装SwitchyOmega插件、信任证书，请参阅<a href="/erra/start.html#代理配置">代理配置</a>、<a href="/erra/trust-ca.html">信任证书</a></em></p></div> <h3 id="接口绑定snippet"><a href="#接口绑定snippet" class="header-anchor">#</a> 接口绑定Snippet</h3> <ol><li>使用Chrome访问<a href="https://www.mocky.io/v2/5185415ba171ea3a00704eed" target="_blank" rel="noopener noreferrer">mocky test api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以得到返回值：</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;world&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li><p>使用SwitchyOmega插件将当前域名的请求使用Erra代理。<br> <img src="/erra/assets/img/mocky-proxy.61834ef5.png" alt="mocky代理设置" width="200"></p></li> <li><p>刷新<a href="https://www.mocky.io/v2/5185415ba171ea3a00704eed" target="_blank" rel="noopener noreferrer">mocky test api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>页面，在Erra Network页可以看到mocky的请求记录，并将其绑定到Simple-Demo。<br> <img src="/erra/assets/img/moky-simple-demo.f78b09eb.png" alt="请求绑定Snippet"></p></li> <li><p>刷新<a href="https://www.mocky.io/v2/5185415ba171ea3a00704eed" target="_blank" rel="noopener noreferrer">mocky test api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>页面，此时收到的返回值应为：</p></li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Erra!&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="编写snippet"><a href="#编写snippet" class="header-anchor">#</a> 编写Snippet</h2> <p>Erra初始时创建了几个Snippet Demo，你可以参考Demo学习简单用法。<br>
可以尝试点击Snippet标签页下的“新增Snippet”按钮
<img src="/erra/assets/img/new-snippet.2b584c7a.png" alt="新增Snippet入口"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果你要尝试学习本节内容，强烈建议参考<a href="/erra/start.html">前文</a>启动Erra，从自带的Demo开始入手。</p></div> <h3 id="修改返回值"><a href="#修改返回值" class="header-anchor">#</a> 修改返回值</h3> <p>使用Snippet自动修改http内容，需要对http数据结构有些许了解。Erra将http结构简化为：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">SimpleReq</span> <span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> HttpMethod<span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> StrObj<span class="token punctuation">,</span>
  body<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">SimpleResp</span> <span class="token punctuation">{</span>
  statusCode<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> StrObj<span class="token punctuation">,</span>
  body<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以最简单的自动<a href="/erra/guide.html#修改返回值">修改返回值</a>为例，将Http Response body内容<code>{ hello: 'world!' }</code>修改为<code>{ hello: Erra! }</code>。<br>
Http Response对应的数据结构为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  statusCode<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    hello<span class="token punctuation">:</span> <span class="token string">'world!'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Simple-Demo</code>对应的Snippet配置如下：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">id</span><span class="token punctuation">:</span> 6353c69c<span class="token punctuation">-</span>e1e6<span class="token punctuation">-</span>4b34<span class="token punctuation">-</span>a61a<span class="token punctuation">-</span>c44271fce483
<span class="token key atrule">name</span><span class="token punctuation">:</span> Simple<span class="token punctuation">-</span>Demo
<span class="token key atrule">content</span><span class="token punctuation">:</span>
  <span class="token key atrule">body</span><span class="token punctuation">:</span>
    <span class="token key atrule">hello</span><span class="token punctuation">:</span> Erra!
</code></pre></div><p>我们可以看到，修改（或者说“覆盖”）Http请求中的某个值，只需要<code>content</code>内容的层级结构与之保持一致即可，不需要修改的字段（statusCode、headers）可以省略。</p> <h3 id="集成mockjs，生成随机数"><a href="#集成mockjs，生成随机数" class="header-anchor">#</a> 集成mockjs，生成随机数</h3> <p>Snippet集成了Mockjs，用来快速生成mock数据。参考Erra自带的Snippet：<code>Mockjs-Random</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Mockjs<span class="token punctuation">-</span>Random
<span class="token key atrule">content</span><span class="token punctuation">:</span>
  <span class="token key atrule">body</span><span class="token punctuation">:</span>
    <span class="token comment"># key的前缀`$mockjs `表示这个字段将被mockjs解析。</span>
    <span class="token comment"># 根据mockjs语法，hello的值将是一个随机字符串。</span>
    $mockjs hello<span class="token punctuation">:</span> <span class="token string">'@str'</span>
</code></pre></div><p>参考<a href="/erra/guide.html#修改返回值">修改返回值</a>第三步，将mocky请求绑定到<code>Mockjs-Random</code>，再刷新<a href="https://www.mocky.io/v2/5185415ba171ea3a00704eed" target="_blank" rel="noopener noreferrer">mocky test api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>页面，可以看到<code>hello</code>的值变成了随机字符串，可以再尝试刷新几次观察返回值。<br>
这是一个返回示例：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IZUsd&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="代理转发请求"><a href="#代理转发请求" class="header-anchor">#</a> 代理转发请求</h3> <p>代理转发请求实际上就是修改Http请求中的<code>headers.host</code>和<code>url</code>两个字段，参考Erra自带的Snippet：<code>Forward-Meituan</code>。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Forward<span class="token punctuation">-</span>Meituan
<span class="token key atrule">when</span><span class="token punctuation">:</span> <span class="token tag">!&lt;tag:yaml.org,2002:js/regexp&gt;</span> /meituan.com/
<span class="token key atrule">content</span><span class="token punctuation">:</span>
  <span class="token key atrule">headers</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> www.mocky.io
  <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token tag">!&lt;tag:yaml.org,2002:js/function&gt;</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    function anonymous(
    ) <span class="token punctuation">{</span>

    return '/v2/5185415ba171ea3a00704eed'

    <span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>yaml的函数、正则支持参考<a href="https://github.com/nodeca/js-yaml" target="_blank" rel="noopener noreferrer">js-yaml<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<em>上面代码中函数样式是js-yaml解析后的，看起来不是很舒服，是后续需要解决的问题</em>。<br>
这里需要介绍一下字段<code>when</code>，表示请求的url被正则匹配成功，当前Snippet即生效，不需要像在Network页手动页面绑定请求。</p></div> <ol><li>勾选<code>Forward-Meituan</code>前面的Checkbox<br> <img src="/erra/assets/img/selected-forward.cc4d762d.png" alt="勾选Snippet" width="300"></li> <li>访问<a href="https://sh.meituan.com" target="_blank" rel="noopener noreferrer">美团首页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>参考前文配置使用Erra代理，刷新页面</li> <li>可以看到美团首页返回了一个json <code>{ &quot;hello&quot;: &quot;world&quot; }</code></li></ol> <h3 id="注入eruda"><a href="#注入eruda" class="header-anchor">#</a> 注入Eruda</h3> <p><a href="https://github.com/liriliri/eruda" target="_blank" rel="noopener noreferrer">Eruda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一款优秀的移动端Console工具，参考Erra自带的Snippet<code>Inject-Eruda</code>，原理就是向html中插入Eruda的启动代码。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Inject<span class="token punctuation">-</span>Eruda
<span class="token key atrule">content</span><span class="token punctuation">:</span>
  <span class="token key atrule">headers</span><span class="token punctuation">:</span>
    <span class="token comment"># 避免被资源被CSP拦截</span>
    <span class="token key atrule">content-security-policy</span><span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token comment"># Snippet除了简单值之外还支持“表达式”，变量“V”是对原始值中当前字段的引用</span>
  <span class="token key atrule">body</span><span class="token punctuation">:</span> <span class="token tag">!&lt;!expression&gt;</span> <span class="token punctuation">&gt;</span><span class="token punctuation">-</span>
    V.replace(/(&lt;body.*<span class="token punctuation">?</span><span class="token punctuation">&gt;</span>)/<span class="token punctuation">,</span>
    '$1&lt;script<span class="token punctuation">&gt;</span>window.define=undefined&lt;/script<span class="token punctuation">&gt;</span>&lt;script
    src=&quot;//cdn.bootcss.com/eruda/1.5.2/eruda.min.js&quot;<span class="token punctuation">&gt;</span>&lt;/script<span class="token punctuation">&gt;</span>&lt;script<span class="token punctuation">&gt;</span>eruda.init();&lt;/script<span class="token punctuation">&gt;</span>')
</code></pre></div><ol><li>去掉<code>Forward-Meituan</code>的勾选状态</li> <li>访问<a href="https://sh.meituan.com" target="_blank" rel="noopener noreferrer">美团首页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Network页给请求<code>https://sh.meituan.com/</code>绑定<code>Inject-Eruda</code></li> <li>刷新美团首页<br> <img src="/erra/assets/img/mt-eruda.fc57859e.png" alt="美团-Eruda" width="400"></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Snippet除了简单值之外还支持“表达式”，变量“V”是对原始值中当前字段的引用。<br>
Inject-Eruda作用于html，所以“V”的值类似：&lt;html&gt;&lt;body&gt;...&lt;/body&gt;&lt;/html&gt;`</p></div> <h3 id="注入erra界面"><a href="#注入erra界面" class="header-anchor">#</a> 注入Erra界面</h3> <p>将Erra UI注入到调试的网页，所有Erra操作可以在当前页面完成，不需要切换浏览器Tab了，提高效率和体验。当有新的断点消息需要处理时，入口图标会闪烁。<br>
注入方式与<a href="/erra/guide.html#注入Eruda">注入Eruda</a>的步骤一致。<br> <img src="/erra/assets/img/mt-erra.584c29d1.png" alt="美团-Erra" width="400"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意第六行的script src，如果被注入的页面在其他设备上打开，此时两台设备必须在同一个局域网内，然后将<strong>localhost改为当前设备的ipv4</strong>（如192.168.1.4）</p></div> <div class="language-yaml extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div></div><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Inject<span class="token punctuation">-</span>Erra
<span class="token key atrule">content</span><span class="token punctuation">:</span>
  <span class="token key atrule">body</span><span class="token punctuation">:</span> <span class="token tag">!&lt;!expression&gt;</span> <span class="token punctuation">&gt;</span><span class="token punctuation">-</span>
    V.replace(/(&lt;body.*<span class="token punctuation">?</span><span class="token punctuation">&gt;</span>)/<span class="token punctuation">,</span> '$1&lt;script
    src=&quot;https<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>4455/erra/erra<span class="token punctuation">-</span>portal.js&quot;<span class="token punctuation">&gt;</span>&lt;/script<span class="token punctuation">&gt;</span>')
</code></pre></div><h3 id="snippet引用"><a href="#snippet引用" class="header-anchor">#</a> Snippet引用</h3> <p>这是Snippet高级功能，为解决mock数据复用的问题而设计。<br>
参考Erra自带的Snippet<code>Include-Snippet</code>，<code>$snippet</code>前缀表示该字段的值交给另一个Snippet去修改。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Include<span class="token punctuation">-</span>Snippet
<span class="token key atrule">content</span><span class="token punctuation">:</span>
  <span class="token key atrule">body</span><span class="token punctuation">:</span>
    <span class="token key atrule">code</span><span class="token punctuation">:</span> <span class="token number">200</span>
    <span class="token comment"># “|”前面的名称是为了方便记忆，忽略名称不会导致错误</span>
    $snippet include<span class="token punctuation">:</span> Simple<span class="token punctuation">-</span>Demo<span class="token punctuation">|</span>6353c69c<span class="token punctuation">-</span>e1e6<span class="token punctuation">-</span>4b34<span class="token punctuation">-</span>a61a<span class="token punctuation">-</span>c44271fce483
</code></pre></div><p>Snippet名称后面的id不需要手动输入，输入名称第一个字母后编辑器会自动补全。<br> <img src="/erra/assets/img/include-snippet-autocomplete.ada86b4d.png" alt="Snippet自动补全" width="400"></p> <p>将mocky请求绑定到<code>Include-Snippet</code>，刷新<a href="https://www.mocky.io/v2/5185415ba171ea3a00704eed" target="_blank" rel="noopener noreferrer">mocky test api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，将得到返回值：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Erra!&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在展开在Array、Object中引用的Snippet时，参考单测用例<br> <a href="https://github.com/hughfenghen/erra/blob/master/src/server/manager/test/snippet-manager.test.ts#L107" target="_blank" rel="noopener noreferrer">展开Object中的snippet引用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://github.com/hughfenghen/erra/blob/master/src/server/manager/test/snippet-manager.test.ts#L130" target="_blank" rel="noopener noreferrer">展开Array中的snippet引用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/erra/trust-ca.html" class="prev">信任证书</a></span> <span class="next"><a href="/erra/config-desc.html">配置说明</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/erra/assets/js/app.714abe1d.js" defer></script><script src="/erra/assets/js/2.9ae94962.js" defer></script><script src="/erra/assets/js/3.e1545a35.js" defer></script>
  </body>
</html>
